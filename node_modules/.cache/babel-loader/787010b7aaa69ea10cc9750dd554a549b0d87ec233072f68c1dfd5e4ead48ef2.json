{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/esnext.iterator.constructor.js\";\nimport \"core-js/modules/esnext.iterator.every.js\";\nimport \"core-js/modules/esnext.iterator.filter.js\";\nimport \"core-js/modules/esnext.iterator.find.js\";\nimport \"core-js/modules/esnext.iterator.for-each.js\";\nimport \"core-js/modules/esnext.iterator.map.js\";\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n    r,\n    ar = [],\n    e;\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n  return ar;\n};\nvar __spreadArray = this && this.__spreadArray || function (to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n    if (ar || !(i in from)) {\n      if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n      ar[i] = from[i];\n    }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n};\nimport { useState, useRef, useCallback } from 'react';\nimport { getSorterPriority, getSorterFn } from '../utils';\nimport useUpdate from '../../_util/hooks/useUpdate';\nimport { isNumber } from '../../_util/is';\nexport default function useSorter(flattenColumns, defaultSorters) {\n  var _a = __read(useState(defaultSorters), 2),\n    activeSorters = _a[0],\n    setActiveSorters = _a[1];\n  var _b = __read(useState({}), 2),\n    currentSorter = _b[0],\n    setCurrentSorter = _b[1];\n  var prevFlattenColumnsRef = useRef(flattenColumns);\n  var getNextActiveSorters = useCallback(function (sorter) {\n    var field = sorter.field,\n      direction = sorter.direction;\n    if (activeSorters.find(function (item) {\n      return item.field === field;\n    })) {\n      if (!direction) {\n        return activeSorters.filter(function (item) {\n          return item.field !== field;\n        });\n      }\n      return activeSorters.map(function (item) {\n        return item.field === field ? sorter : item;\n      });\n    }\n    // This is theoretically impossible\n    if (!direction) {\n      return __spreadArray([], __read(activeSorters), false);\n    }\n    if (!isNumber(sorter.priority) || activeSorters.find(function (item) {\n      return !isNumber(item.priority);\n    })) {\n      return [sorter];\n    }\n    return __spreadArray(__spreadArray([], __read(activeSorters), false), [sorter], false);\n  }, [activeSorters]);\n  var getControlledSorters = useCallback(function (columns) {\n    var controlledColumns = columns.filter(function (column) {\n      return 'sortOrder' in column;\n    });\n    var sorters = [];\n    controlledColumns.forEach(function (column) {\n      var priority = getSorterPriority(column.sorter);\n      var direction = column.sortOrder;\n      var sorter = {\n        field: column.key,\n        direction: direction,\n        sorterFn: getSorterFn(column.sorter),\n        priority: priority\n      };\n      if (!direction) {\n        sorters.push(sorter);\n      } else if (isNumber(priority)) {\n        if (sorters.every(function (item) {\n          return isNumber(item.priority) || !item.direction;\n        })) {\n          sorters.push(sorter);\n        }\n      } else if (sorters.every(function (item) {\n        return !item.direction;\n      })) {\n        sorters.push(sorter);\n      } else {\n        sorters = [sorter];\n      }\n    });\n    return sorters;\n  }, []);\n  var updateStateSorters = useCallback(function (sorter, nextActiveSorters) {\n    var controlledSorters = getControlledSorters(flattenColumns);\n    if (!controlledSorters.length) {\n      setActiveSorters(nextActiveSorters);\n      setCurrentSorter(sorter);\n    }\n  }, [flattenColumns, getControlledSorters, setActiveSorters, setCurrentSorter]);\n  useUpdate(function () {\n    var prevFlattenColumns = prevFlattenColumnsRef.current;\n    var prevControlledSorters = getControlledSorters(prevFlattenColumns);\n    var controlledSorters = getControlledSorters(flattenColumns);\n    var prevControlledFields = prevControlledSorters.map(function (item) {\n      return item.field;\n    });\n    var changedSorters = controlledSorters.filter(function (item) {\n      var changed = prevControlledSorters.find(function (_a) {\n        var field = _a.field,\n          direction = _a.direction;\n        return item.field === field && item.direction !== direction;\n      });\n      if (changed) {\n        return true;\n      }\n      // 新增的sorter，用于处理开始不受控，之后又受控了的情况\n      return !prevControlledFields.includes(item.field);\n    });\n    if (changedSorters && changedSorters.length) {\n      setActiveSorters(controlledSorters);\n      setCurrentSorter({});\n    }\n    // update prevFlattenColumns\n    prevFlattenColumnsRef.current = flattenColumns;\n  }, [flattenColumns, getControlledSorters, getNextActiveSorters, setCurrentSorter, setActiveSorters]);\n  return {\n    currentSorter: currentSorter,\n    activeSorters: activeSorters,\n    getNextActiveSorters: getNextActiveSorters,\n    updateStateSorters: updateStateSorters\n  };\n}","map":{"version":3,"names":["__read","o","n","m","Symbol","iterator","i","call","r","ar","e","next","done","push","value","error","__spreadArray","to","from","pack","arguments","length","l","Array","prototype","slice","concat","useState","useRef","useCallback","getSorterPriority","getSorterFn","useUpdate","isNumber","useSorter","flattenColumns","defaultSorters","_a","activeSorters","setActiveSorters","_b","currentSorter","setCurrentSorter","prevFlattenColumnsRef","getNextActiveSorters","sorter","field","direction","find","item","filter","map","priority","getControlledSorters","columns","controlledColumns","column","sorters","forEach","sortOrder","key","sorterFn","every","updateStateSorters","nextActiveSorters","controlledSorters","prevFlattenColumns","current","prevControlledSorters","prevControlledFields","changedSorters","changed","includes"],"sources":["D:/Nodejs/oj-frontend/node_modules/@arco-design/web-react/es/Table/hooks/useSorter.js"],"sourcesContent":["var __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nimport { useState, useRef, useCallback } from 'react';\nimport { getSorterPriority, getSorterFn } from '../utils';\nimport useUpdate from '../../_util/hooks/useUpdate';\nimport { isNumber } from '../../_util/is';\nexport default function useSorter(flattenColumns, defaultSorters) {\n    var _a = __read(useState(defaultSorters), 2), activeSorters = _a[0], setActiveSorters = _a[1];\n    var _b = __read(useState({}), 2), currentSorter = _b[0], setCurrentSorter = _b[1];\n    var prevFlattenColumnsRef = useRef(flattenColumns);\n    var getNextActiveSorters = useCallback(function (sorter) {\n        var field = sorter.field, direction = sorter.direction;\n        if (activeSorters.find(function (item) { return item.field === field; })) {\n            if (!direction) {\n                return activeSorters.filter(function (item) { return item.field !== field; });\n            }\n            return activeSorters.map(function (item) { return (item.field === field ? sorter : item); });\n        }\n        // This is theoretically impossible\n        if (!direction) {\n            return __spreadArray([], __read(activeSorters), false);\n        }\n        if (!isNumber(sorter.priority) || activeSorters.find(function (item) { return !isNumber(item.priority); })) {\n            return [sorter];\n        }\n        return __spreadArray(__spreadArray([], __read(activeSorters), false), [sorter], false);\n    }, [activeSorters]);\n    var getControlledSorters = useCallback(function (columns) {\n        var controlledColumns = columns.filter(function (column) { return 'sortOrder' in column; });\n        var sorters = [];\n        controlledColumns.forEach(function (column) {\n            var priority = getSorterPriority(column.sorter);\n            var direction = column.sortOrder;\n            var sorter = {\n                field: column.key,\n                direction: direction,\n                sorterFn: getSorterFn(column.sorter),\n                priority: priority,\n            };\n            if (!direction) {\n                sorters.push(sorter);\n            }\n            else if (isNumber(priority)) {\n                if (sorters.every(function (item) { return isNumber(item.priority) || !item.direction; })) {\n                    sorters.push(sorter);\n                }\n            }\n            else if (sorters.every(function (item) { return !item.direction; })) {\n                sorters.push(sorter);\n            }\n            else {\n                sorters = [sorter];\n            }\n        });\n        return sorters;\n    }, []);\n    var updateStateSorters = useCallback(function (sorter, nextActiveSorters) {\n        var controlledSorters = getControlledSorters(flattenColumns);\n        if (!controlledSorters.length) {\n            setActiveSorters(nextActiveSorters);\n            setCurrentSorter(sorter);\n        }\n    }, [flattenColumns, getControlledSorters, setActiveSorters, setCurrentSorter]);\n    useUpdate(function () {\n        var prevFlattenColumns = prevFlattenColumnsRef.current;\n        var prevControlledSorters = getControlledSorters(prevFlattenColumns);\n        var controlledSorters = getControlledSorters(flattenColumns);\n        var prevControlledFields = prevControlledSorters.map(function (item) { return item.field; });\n        var changedSorters = controlledSorters.filter(function (item) {\n            var changed = prevControlledSorters.find(function (_a) {\n                var field = _a.field, direction = _a.direction;\n                return item.field === field && item.direction !== direction;\n            });\n            if (changed) {\n                return true;\n            }\n            // 新增的sorter，用于处理开始不受控，之后又受控了的情况\n            return !prevControlledFields.includes(item.field);\n        });\n        if (changedSorters && changedSorters.length) {\n            setActiveSorters(controlledSorters);\n            setCurrentSorter({});\n        }\n        // update prevFlattenColumns\n        prevFlattenColumnsRef.current = flattenColumns;\n    }, [\n        flattenColumns,\n        getControlledSorters,\n        getNextActiveSorters,\n        setCurrentSorter,\n        setActiveSorters,\n    ]);\n    return {\n        currentSorter: currentSorter,\n        activeSorters: activeSorters,\n        getNextActiveSorters: getNextActiveSorters,\n        updateStateSorters: updateStateSorters,\n    };\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}