{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.set.difference.v2.js\";\nimport \"core-js/modules/es.set.intersection.v2.js\";\nimport \"core-js/modules/es.set.is-disjoint-from.v2.js\";\nimport \"core-js/modules/es.set.is-subset-of.v2.js\";\nimport \"core-js/modules/es.set.is-superset-of.v2.js\";\nimport \"core-js/modules/es.set.symmetric-difference.v2.js\";\nimport \"core-js/modules/es.set.union.v2.js\";\nimport \"core-js/modules/esnext.iterator.constructor.js\";\nimport \"core-js/modules/esnext.iterator.every.js\";\nimport \"core-js/modules/esnext.iterator.for-each.js\";\n/**\n * 该组件用来切换tree 展开收起时的动画\n */\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nimport React, { useMemo, useContext, useEffect, useRef } from 'react';\nimport { TreeContext } from './context';\nimport VirtualList from '../_class/VirtualList';\nimport { ConfigContext } from '../ConfigProvider';\nimport Node from './node';\nimport { isNumber } from '../_util/is';\nimport ArcoCSSTransition from '../_util/CSSTransition';\nfunction getKey(option) {\n  return option.key || option._key;\n}\nvar TreeAnimation = function (props) {\n  var _a;\n  var treeContext = useContext(TreeContext);\n  var getPrefixCls = useContext(ConfigContext).getPrefixCls;\n  var prefixCls = getPrefixCls('tree-node');\n  var _b = treeContext.getTreeState(),\n    expandedKeys = _b.expandedKeys,\n    currentExpandKeys = _b.currentExpandKeys;\n  var expanded = props.expanded;\n  var propsChildrenDataRef = useRef(props.childrenData);\n  propsChildrenDataRef.current = props.childrenData;\n  useEffect(function () {\n    return function () {\n      treeContext.onExpandEnd && treeContext.onExpandEnd(props._key);\n    };\n  }, []);\n  var childrenPropsList = useMemo(function () {\n    var result = [];\n    var loop = function (list) {\n      list.forEach(function (item) {\n        var data = treeContext.getFieldInfo(item);\n        result.push(data);\n        if (data.children && data.children.length) {\n          loop(data.children);\n        }\n      });\n    };\n    loop(propsChildrenDataRef.current || []);\n    return result;\n  }, [expanded]);\n  var filtedData = useMemo(function () {\n    var result = [];\n    if (childrenPropsList.length) {\n      var expandedKeysSet_1 = new Set(expandedKeys || []);\n      childrenPropsList.forEach(function (data) {\n        var _a;\n        var isShow;\n        var itemProps = __assign({}, treeContext.key2nodeProps[data.key]);\n        if (expanded) {\n          // 只有在每一个父节点都是展开状态时，自己才会展示出来\n          isShow = itemProps.parentKey === props._key || ((_a = itemProps.pathParentKeys) === null || _a === void 0 ? void 0 : _a.every(function (key) {\n            return expandedKeysSet_1.has(key);\n          }));\n        } else if (itemProps.pathParentKeys) {\n          // 收起时，只有在props._key 对应的位置之后的所有的自己的父节点都是展开状态，才会展示自己\n          var index = itemProps.pathParentKeys.indexOf(props._key);\n          isShow = itemProps.pathParentKeys.slice(index + 1).every(function (key) {\n            return expandedKeysSet_1.has(key);\n          });\n        }\n        if (isShow) {\n          result.push(__assign(__assign({}, itemProps), {\n            key: data.key\n          }));\n        }\n      });\n    }\n    return treeContext.getNodeProps(result);\n  }, [childrenPropsList, props._key, expanded, expandedKeys]);\n  var realHeight = (_a = treeContext.virtualListProps) === null || _a === void 0 ? void 0 : _a.height;\n  realHeight = isNumber(realHeight) ? realHeight : 0;\n  useEffect(function () {\n    // node set loadingMore but has no child nodes.\n    // Animation will not be triggered and needs to be removed manually\n    if (currentExpandKeys.indexOf(props._key) > -1 && filtedData.length === 0) {\n      treeContext.onExpandEnd(props._key);\n    }\n  }, [filtedData, currentExpandKeys]);\n  return React.createElement(ArcoCSSTransition, {\n    in: currentExpandKeys.indexOf(props._key) > -1 && filtedData.length > 0,\n    unmountOnExit: true,\n    classNames: \"tree-slide-expand\",\n    timeout: {\n      enter: 200,\n      exit: 0\n    },\n    onEnter: function (e) {\n      if (!e) return;\n      var scrollHeight = e.scrollHeight;\n      e.style.height = expanded ? 0 : Math.min(realHeight || scrollHeight, e.scrollHeight) + \"px\";\n    },\n    onEntering: function (e) {\n      if (!e) return;\n      var scrollHeight = e.scrollHeight;\n      e.style.height = expanded ? Math.min(realHeight || scrollHeight, scrollHeight) + \"px\" : 0;\n    },\n    onEntered: function (e) {\n      if (!e) return;\n      e.style.height = props.expanded ? '' : 0;\n      treeContext.onExpandEnd(props._key);\n    },\n    onExit: function (e) {\n      if (!e) return;\n      e.style.display = 'none';\n    }\n  }, React.createElement(VirtualList, __assign({\n    itemKey: getKey,\n    className: prefixCls + \"-list\",\n    isStaticItemHeight: false\n  }, treeContext.virtualListProps, {\n    data: filtedData,\n    \"aria-hidden\": true,\n    style: {\n      overflow: 'hidden'\n    }\n  }), function (child) {\n    return React.createElement(Node, __assign({}, child));\n  }));\n};\nexport default TreeAnimation;","map":{"version":3,"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","React","useMemo","useContext","useEffect","useRef","TreeContext","VirtualList","ConfigContext","Node","isNumber","ArcoCSSTransition","getKey","option","key","_key","TreeAnimation","props","_a","treeContext","getPrefixCls","prefixCls","_b","getTreeState","expandedKeys","currentExpandKeys","expanded","propsChildrenDataRef","childrenData","current","onExpandEnd","childrenPropsList","result","loop","list","forEach","item","data","getFieldInfo","push","children","filtedData","expandedKeysSet_1","Set","isShow","itemProps","key2nodeProps","parentKey","pathParentKeys","every","has","index","indexOf","slice","getNodeProps","realHeight","virtualListProps","height","createElement","in","unmountOnExit","classNames","timeout","enter","exit","onEnter","e","scrollHeight","style","Math","min","onEntering","onEntered","onExit","display","itemKey","className","isStaticItemHeight","overflow","child"],"sources":["D:/Nodejs/oj-frontend/node_modules/@arco-design/web-react/es/Tree/animation.js"],"sourcesContent":["/**\n * 该组件用来切换tree 展开收起时的动画\n */\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport React, { useMemo, useContext, useEffect, useRef } from 'react';\nimport { TreeContext } from './context';\nimport VirtualList from '../_class/VirtualList';\nimport { ConfigContext } from '../ConfigProvider';\nimport Node from './node';\nimport { isNumber } from '../_util/is';\nimport ArcoCSSTransition from '../_util/CSSTransition';\nfunction getKey(option) {\n    return option.key || option._key;\n}\nvar TreeAnimation = function (props) {\n    var _a;\n    var treeContext = useContext(TreeContext);\n    var getPrefixCls = useContext(ConfigContext).getPrefixCls;\n    var prefixCls = getPrefixCls('tree-node');\n    var _b = treeContext.getTreeState(), expandedKeys = _b.expandedKeys, currentExpandKeys = _b.currentExpandKeys;\n    var expanded = props.expanded;\n    var propsChildrenDataRef = useRef(props.childrenData);\n    propsChildrenDataRef.current = props.childrenData;\n    useEffect(function () {\n        return function () {\n            treeContext.onExpandEnd && treeContext.onExpandEnd(props._key);\n        };\n    }, []);\n    var childrenPropsList = useMemo(function () {\n        var result = [];\n        var loop = function (list) {\n            list.forEach(function (item) {\n                var data = treeContext.getFieldInfo(item);\n                result.push(data);\n                if (data.children && data.children.length) {\n                    loop(data.children);\n                }\n            });\n        };\n        loop(propsChildrenDataRef.current || []);\n        return result;\n    }, [expanded]);\n    var filtedData = useMemo(function () {\n        var result = [];\n        if (childrenPropsList.length) {\n            var expandedKeysSet_1 = new Set(expandedKeys || []);\n            childrenPropsList.forEach(function (data) {\n                var _a;\n                var isShow;\n                var itemProps = __assign({}, treeContext.key2nodeProps[data.key]);\n                if (expanded) {\n                    // 只有在每一个父节点都是展开状态时，自己才会展示出来\n                    isShow =\n                        itemProps.parentKey === props._key ||\n                            ((_a = itemProps.pathParentKeys) === null || _a === void 0 ? void 0 : _a.every(function (key) {\n                                return expandedKeysSet_1.has(key);\n                            }));\n                }\n                else if (itemProps.pathParentKeys) {\n                    // 收起时，只有在props._key 对应的位置之后的所有的自己的父节点都是展开状态，才会展示自己\n                    var index = itemProps.pathParentKeys.indexOf(props._key);\n                    isShow = itemProps.pathParentKeys.slice(index + 1).every(function (key) {\n                        return expandedKeysSet_1.has(key);\n                    });\n                }\n                if (isShow) {\n                    result.push(__assign(__assign({}, itemProps), { key: data.key }));\n                }\n            });\n        }\n        return treeContext.getNodeProps(result);\n    }, [childrenPropsList, props._key, expanded, expandedKeys]);\n    var realHeight = (_a = treeContext.virtualListProps) === null || _a === void 0 ? void 0 : _a.height;\n    realHeight = isNumber(realHeight) ? realHeight : 0;\n    useEffect(function () {\n        // node set loadingMore but has no child nodes.\n        // Animation will not be triggered and needs to be removed manually\n        if (currentExpandKeys.indexOf(props._key) > -1 && filtedData.length === 0) {\n            treeContext.onExpandEnd(props._key);\n        }\n    }, [filtedData, currentExpandKeys]);\n    return (React.createElement(ArcoCSSTransition, { in: currentExpandKeys.indexOf(props._key) > -1 && filtedData.length > 0, unmountOnExit: true, classNames: \"tree-slide-expand\", timeout: {\n            enter: 200,\n            exit: 0,\n        }, onEnter: function (e) {\n            if (!e)\n                return;\n            var scrollHeight = e.scrollHeight;\n            e.style.height = expanded ? 0 : Math.min(realHeight || scrollHeight, e.scrollHeight) + \"px\";\n        }, onEntering: function (e) {\n            if (!e)\n                return;\n            var scrollHeight = e.scrollHeight;\n            e.style.height = expanded ? Math.min(realHeight || scrollHeight, scrollHeight) + \"px\" : 0;\n        }, onEntered: function (e) {\n            if (!e)\n                return;\n            e.style.height = props.expanded ? '' : 0;\n            treeContext.onExpandEnd(props._key);\n        }, onExit: function (e) {\n            if (!e)\n                return;\n            e.style.display = 'none';\n        } },\n        React.createElement(VirtualList, __assign({ itemKey: getKey, className: prefixCls + \"-list\", isStaticItemHeight: false }, treeContext.virtualListProps, { data: filtedData, \"aria-hidden\": true, style: { overflow: 'hidden' } }), function (child) {\n            return React.createElement(Node, __assign({}, child));\n        })));\n};\nexport default TreeAnimation;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}